@using MailAutomation.Application.Common
@model MailDto


<div class="container">
    <h2 class="mb-3">
        مشاهده نامه
    </h2>
    <div class="d-flex justify-content-between align-items-center text-muted mb-4">
        @if (Model.SenderUserName == User.Identity.Name)
        {
            <span class="d-block">
                به @Model.ReceiverFirstName @Model.ReceiverLastName
            </span>

        }
        else
        {
            <span class="d-block">
                از @Model.SenderFirstName @Model.SenderLastName
            </span>
        }
        <span class="d-block text-muted">
            @Model.Date.ToString("yyyy/dd/MM HH:mm")
        </span>

        <div class="d-flex">
            <a data-bs-toggle="tooltip" data-bs-title="پاسخ" class="icon-box-sm mx-3" asp-action="Reply" asp-controller="Mail" asp-route-parentMailId="@Model.MailId">
                <svg height="20" width="20" class="text-primary">
                    <use href="/assets/images/icons/reply.svg" width="20" height="20" />
                </svg>
            </a>
            @if (User.Identity.Name == Model.SenderUserName)
            {
                if (Model.IsRemoved == true)
                {
                    <a data-bs-toggle="tooltip" data-bs-title="بازگرداندن" class="icon-box-sm" asp-action="Restore" asp-controller="Mail" asp-route-mailId="@Model.MailId">
                        <svg height="20" width="20" class="text-primary">
                            <use href="/assets/images/icons/arrow-bar-up.svg" width="20" height="20" />
                        </svg>
                    </a>
                }
                else
                {
                    <a data-bs-toggle="tooltip" data-bs-title="پاک کردن" class="icon-box-sm" asp-action="Remove" asp-controller="Mail" asp-route-mailId="@Model.MailId">
                        <svg height="20" width="20" class="text-danger">
                            <use href="/assets/images/icons/trash.svg" width="20" height="20" />
                        </svg>
                    </a>
                }
            }
           

        </div>
    </div>
    <hr>
    <div class="mail-box p-3">
        <h2>@Model.Title</h2>
        <p class="">
            @Model.Body
        </p>
    </div>
    @if (Model.Replies?.ToList().Count > 0)
    {
        <div class="replies mt-4 p-3 replies">
            <h3 class="mb-3">پاسخ ها</h3>
            <table class=" align-items-center">

                <tbody>
                    @{
                        int counter = 0;
                    }
                    @foreach (var mail in Model.Replies)
                    {
                        <tr>
                            <td>
                                @(++counter)
                            </td>
                            <td>
                                <p class="mb-0">@mail.SenderFirstName @mail.SenderLastName</p>
                                <p class="text-secondary mb-0">@mail.SenderUserName</p>
                            </td>
                            <td class="align-middle ">
                                <span class="text-secondary text-xs font-weight-bold">@mail.Date.ToString("yyyy/dd/MM HH:mm")</span>
                            </td>
                            <td>

                                <p class="fw-light text-secondary mb-0">
                                    @(mail.Body.Length > 18 ?
                                                                mail.Body.Substring(0, 18) + "..." :
                                                                mail.Body)
                        </p>
                    </td>


                            <td class="align-middle">
                                <div class="d-flex">
                                    <a data-bs-toggle="tooltip" data-bs-title="دیدن" class="icon-box-sm me-2" asp-action="ShowMail" asp-controller="Mail" asp-route-mailId="@mail.MailId">
                                        <svg height="20" width="20" class="text-success">
                                            <use href="/assets/images/icons/eye-fill.svg" width="20" height="20" />
                                        </svg>
                                    </a>




                                </div>
                            </td>
                        </tr>
                                }

                </tbody>
            </table>
        </div>
    }
</div>
